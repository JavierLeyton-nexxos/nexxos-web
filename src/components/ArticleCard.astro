---
import { formatDate, calculateReadTime } from '../utils/index'
import { getLangFromUrl } from '../i18n/utils'
import { Image } from 'astro:assets'

interface Props {
	post: any
}

const { post } = Astro.props
const lang = getLangFromUrl(Astro.url)

const title = post.title
const slug = post.slug
const publishedAt = post.publishedAt
const excerpt = post.excerpt

const PUBLIC_PAYLOAD_URL =
	import.meta.env.PAYLOAD_URL || 'https://payload.wedit.tech'

// Use heroImage if available, fallback to meta.image
const imageObj = post.heroImage || post.meta?.image
let thumbnail = null

if (imageObj?.url) {
	const rawUrl = imageObj.url
	thumbnail = {
		src: rawUrl.startsWith('http')
			? rawUrl
			: `${PUBLIC_PAYLOAD_URL}${rawUrl}`,
		width: imageObj.width || 1200,
		height: imageObj.height || 675,
		alt: imageObj.alt || title,
	}
}

const formattedDate = formatDate(publishedAt, lang)
const readTime = calculateReadTime(post.content)

const blogPath = lang === 'es' ? `/blog/${slug}` : `/${lang}/blog/${slug}`

// Convert date to uppercase for the "Nexxos" style
const uppercaseDate = formattedDate.toUpperCase()
---

<a
	href={blogPath}
	class='group block bg-white border border-brand-black/5 rounded-2xl overflow-hidden transition-all duration-500 hover:shadow-2xl hover:-translate-y-1 reveal'
>
	{
		thumbnail && (
			<div class='aspect-[16/9] overflow-hidden'>
				<Image
					src={thumbnail.src}
					width={thumbnail.width}
					height={thumbnail.height}
					alt={thumbnail.alt}
					class='w-full h-full object-cover transition-transform duration-700 group-hover:scale-105'
				/>
			</div>
		)
	}
	<div class='p-8 flex flex-col h-full'>
		<h3
			class='text-2xl md:text-3xl font-bold text-brand-black mb-4 group-hover:text-brand-blue transition-colors leading-[1.1] tracking-tighter uppercase'
		>
			{title}
		</h3>

		{
			excerpt && (
				<p class='text-sm text-brand-black/70 line-clamp-3 leading-relaxed mb-8 flex-grow'>
					{excerpt}
				</p>
			)
		}

		<div class='flex items-center gap-4 pt-4 border-t border-brand-black/5'>
			<span
				class='text-[11px] font-bold uppercase tracking-[0.2em] text-brand-black/40'
			>
				{uppercaseDate}
			</span>
			<span
				class='text-[11px] font-bold uppercase tracking-[0.2em] text-brand-blue'
			>
				{readTime}
			</span>
		</div>
	</div>
</a>
